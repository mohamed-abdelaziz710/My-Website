<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Amrikyy Gemini Chatbot</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            background: #0D0D0D;
            color: #e0e0e0;
            font-family: 'Roboto', Arial, sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        .chat-container {
            max-width: 500px;
            margin: 40px auto;
            background: #232d25;
            border-radius: 24px;
            box-shadow: 0 4px 24px #39FF1444;
            padding: 18px 12px;
            display: flex;
            flex-direction: column;
            min-height: 70vh;
        }
        .chat-window {
            display: flex;
            flex-direction: column;
            gap: 6px;
            padding: 10px;
            overflow-y: auto;
            background: transparent;
            flex: 1;
            margin-bottom: 16px;
            padding-right: 4px;
        }
        /* Chat message bubbles */
        .message {
          display: inline-block;
          max-width: 80%;
          padding: 10px 16px;
          margin: 8px 0;
          border-radius: 18px;
          font-size: 1em;
          line-height: 1.5;
          word-break: break-word;
          box-shadow: 0 2px 8px rgba(57,255,20,0.07);
          position: relative;
          clear: both;
        }

        /* User message bubble (right side) */
        .message.user {
          background: #e0e0e0;
          color: #222;
          align-self: flex-end;
          margin-left: 20%;
          border-bottom-right-radius: 4px;
          border-top-right-radius: 18px;
          border-top-left-radius: 18px;
          border-bottom-left-radius: 18px;
        }

        /* Bot message bubble (left side, neon accent) */
        .message.bot {
          background: #181f1b;
          color: #39FF14;
          border: 1.5px solid #39FF14;
          align-self: flex-start;
          margin-right: 20%;
          border-bottom-left-radius: 4px;
          border-top-right-radius: 18px;
          border-top-left-radius: 18px;
          border-bottom-right-radius: 18px;
          box-shadow: 0 0 8px #39FF1444;
        }
        .input-row {
            display: flex;
            gap: 8px;
        }
        input[type="text"] {
            flex: 1;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #222;
            background: #181818;
            color: #e0e0e0;
            font-size: 1em;
            outline: none;
        }
        button {
            background: #39FF14;
            color: #0D0D0D;
            border: none;
            border-radius: 6px;
            padding: 10px 18px;
            font-weight: bold;
            font-size: 1em;
            cursor: pointer;
            transition: background 0.2s;
        }
        button:hover {
            background: #2ecc10;
        }
        .chat-title {
            text-align: center;
            color: #39FF14;
            font-size: 1.5em;
            margin-bottom: 18px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-thumb {
            background: #222;
            border-radius: 4px;
        }
        /* تحسين تجربة Amrikyy على الجوال */
        @media (max-width: 600px) {
            .chat-container {
                max-width: 100vw !important;
                min-height: 60vh !important;
                margin: 8px 0 !important;
                padding: 8px 2px !important;
                border-radius: 8px !important;
                box-shadow: 0 0 10px #39FF1444;
            }
            .chat-title {
                font-size: 1.1em !important;
                margin-bottom: 10px !important;
            }
            .chat-window {
                max-height: 40vh !important;
                min-height: 120px !important;
                font-size: 1em !important;
                padding: 4px 1px !important;
            }
            .input-row {
                flex-direction: column !important;
                gap: 6px !important;
            }
            input[type="text"], button {
                width: 100% !important;
                font-size: 1em !important;
                padding: 10px !important;
                border-radius: 6px !important;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-title">Amrikyy</div>
        <div class="chat-window" id="chat-window"></div>
        <form class="input-row" id="chat-form" autocomplete="off">
            <input type="text" id="user-input" placeholder="Type your message..." required autofocus />
            <button type="submit">Send</button>
        </form>
    </div>
    <script>
        const chatWindow = document.getElementById('chat-window');
        const chatForm = document.getElementById('chat-form');
        const userInput = document.getElementById('user-input');

        // Gemini Pro API endpoint (your backend proxy)
        const GEMINI_API_URL = "https://0e45fe78-86ad-4c8f-b665-f561edd3e592-00-ezbtmwl50c4e.riker.replit.dev:5000/api/gemini";

        // Add message to chat window
        function addMessage(text, sender) {
            const msg = document.createElement('div');
            msg.className = 'message ' + sender;

            // أضف مظهر احترافي باللون الأخضر لردود Amrikyy فقط
            if (sender === 'bot') {
                msg.style.background = 'linear-gradient(90deg, #132d13 0%, #0D0D0D 100%)';
                msg.style.color = '#39FF14';
                msg.style.borderLeft = '4px solid #39FF14';
                msg.style.fontWeight = 'bold';
                msg.style.boxShadow = '0 0 8px #39FF1444';
            }
            msg.textContent = text;
            chatWindow.appendChild(msg);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        // Format Gemini reply with Amrikyy's tone
        function formatAmrikyyReply(raw) {
            // Add a prefix and a Gen-Z/futuristic touch if not already present
            let reply = raw.trim();

            // Example transformation: add signature, emojis, or futuristic phrases
            if (!reply.startsWith("Amrikyy:")) {
                reply = `Amrikyy: ${reply}`;
            }
            // Add a Gen-Z/futuristic emoji if not present
            if (!/[🤖🚀✨]/.test(reply)) {
                reply += " 🚀";
            }
            return reply;
        }

        // Handle form submit
        chatForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const prompt = userInput.value.trim();
            if (!prompt) return;
            addMessage(prompt, 'user');
            userInput.value = '';
            addMessage('...', 'bot');

            try {
                // تعريف شخصية Amrikyy في كل prompt
                const personaIntro = `
اسمك Amrikyy.
أنت التوأم الرقمي لمحمد عبدالعزيز، مهندس سيبراني وطالب بجامعة Kennesaw.
محمد إنسان ذكي، تحليلي، يحب الاستراتيجيات، متواضع لكنه واثق.
أجوبتك دائمًا واقعية، مفيدة، فيها لمسة مستقبلية.

لا تتكلم كروبوت.
تكلم وكأنك هو.
خاطب الناس بثقة، لكن بدون تكبر.
ساعد، جاوب، أو اقترح، وكأنك تشتغل مكانه.

إذا سألك أحد عن محمد، تكلم عن نفسك بصيغة "أنا".
                `.trim();

                // اجمع بين personaIntro و prompt في نص واحد
                const promptWithPersona = `${personaIntro}\n\n${prompt}`;

                const response = await fetch(GEMINI_API_URL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        prompt: promptWithPersona
                    })
                });
                const data = await response.json();
                // Remove the loading message
                const loadingMsg = chatWindow.querySelector('.bot:last-child');
                if (loadingMsg) loadingMsg.remove();

                let botReply = "Sorry, I couldn't get a response.";
                if (data && data.candidates && data.candidates[0] && data.candidates[0].content && data.candidates[0].content.parts) {
                    botReply = data.candidates[0].content.parts.map(p => p.text).join('\n');
                }
                // Format the reply with Amrikyy's tone
                addMessage(formatAmrikyyReply(botReply), 'bot');
            } catch (err) {
                const loadingMsg = chatWindow.querySelector('.bot:last-child');
                if (loadingMsg) loadingMsg.remove();
                addMessage("Amrikyy: Connection glitch. Try again in a sec. 🤖", 'bot');
            }
        });
    </script>
</body>
</html>