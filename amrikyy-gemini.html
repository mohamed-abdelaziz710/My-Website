<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Amrikyy Gemini Chatbot</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            background: #181f1b; /* or #101510 for a dark theme */
            color: #e0e0e0;
            font-family: 'DM Sans', sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        /* Chatbot Styles Fix */
        .chat-container {
          width: 100%;
          max-width: 370px;
          background: #181f1b;
          border: 2.5px solid #39FF14;
          border-radius: 28px;
          box-shadow: 0 8px 32px #39FF1444, 0 2px 8px #0008;
          padding: 18px 12px 12px 12px;
          position: fixed;
          right: 24px;
          bottom: 24px;
          z-index: 9999;
          display: flex;
          flex-direction: column;
          min-height: 420px;
          height: 480px;
          transition: box-shadow 0.2s, transform 0.2s;
        }

        .chat-title {
          text-align: center;
          font-size: 1.2rem;
          color: #39FF14;
          font-weight: bold;
          margin-bottom: 10px;
        }

        .chat-window {
          flex: 1;
          overflow-y: auto;
          background: transparent;
          padding: 6px 2px;
          display: flex;
          flex-direction: column;
          gap: 8px;
          margin-bottom: 10px;
          border-radius: 10px;
        }
        .input-row {
          display: flex;
          gap: 8px;
        }
        .input-row input[type="text"] {
          flex: 1;
          padding: 12px;
          background: #181818;
          color: #fff;
          border: 1px solid #39FF14;
          border-radius: 8px;
          font-size: 1em;
          outline: none;
        }

        .input-row button {
          background: #39FF14;
          color: #0D0D0D;
          border: none;
          border-radius: 8px;
          padding: 12px 18px;
          font-weight: bold;
          font-size: 1.1em;
          min-width: 48px;
          min-height: 48px;
          cursor: pointer;
          transition: background 0.2s;
        }
        .input-row button:hover {
          background: #2ecc10;
        }

        /* Chat message bubbles */
        .message {
          display: inline-block;
          max-width: 85%;
          padding: 10px 16px;
          border-radius: 18px;
          font-size: 1em;
          line-height: 1.5;
          word-break: break-word;
          box-shadow: 0 2px 8px rgba(57,255,20,0.07);
          position: relative;
          clear: both;
        }
        .message.user {
          background: #e0e0e0;
          color: #222;
          align-self: flex-end;
          margin-left: 15%;
          border-bottom-right-radius: 4px;
        }
        .message.bot {
          background: #232d25;
          color: #39FF14;
          border: 1.5px solid #39FF14;
          align-self: flex-start;
          margin-right: 15%;
          border-bottom-left-radius: 4px;
          box-shadow: 0 0 8px #39FF1444;
        }
        button {
            background: #39FF14;
            color: #0D0D0D;
            border: none;
            border-radius: 6px;
            padding: 14px 22px; /* Larger padding */
            font-weight: bold;
            font-size: 1.15em;  /* Larger font */
            min-width: 48px;    /* Minimum touch target */
            min-height: 48px;
            cursor: pointer;
            transition: background 0.2s;
        }
        button:hover {
            background: #2ecc10;
        }
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-thumb {
            background: #222;
            border-radius: 4px;
        }
        /* تحسين تجربة Amrikyy على الجوال */
        @media (max-width: 600px) {
          .chat-container {
              left: 1vw;
              right: 1vw;
              bottom: 1vh;
              width: 98vw;
              height: 60vh;
              min-height: 320px;
              border-radius: 14px;
              padding: 10px 4px 8px 4px;
          }
          .chat-window {
            max-height: 40vh;
            min-height: 120px;
            font-size: 1em;
            padding: 4px 1px;
          }
          .input-row {
            flex-direction: column;
            gap: 6px;
          }
          .input-row input[type="text"], .input-row button {
            width: 100%;
            font-size: 1em;
            padding: 12px;
            border-radius: 8px;
          }
          .message {
            max-width: 95vw;
            font-size: 0.98em;
          }
        }
    </style>
</head>
<body>
    <div class="chat-container">
  <div class="chat-header">
    <span class="chat-title">Amrikyy</span>
    <button class="chat-close" title="Close">&times;</button>
  </div>
  <div class="chat-window" id="chat-window"></div>
  <form class="input-row" id="chat-form" autocomplete="off">
    <input type="text" id="user-input" placeholder="Type your message..." required autofocus />
    <button type="submit">Send</button>
  </form>
</div>
    <script>
        const chatWindow = document.getElementById('chat-window');
        const chatForm = document.getElementById('chat-form');
        const userInput = document.getElementById('user-input');

        // Gemini Pro API endpoint (your backend proxy)
        const GEMINI_API_URL = "https://0e45fe78-86ad-4c8f-b665-f561edd3e592-00-ezbtmwl50c4e.riker.replit.dev:5000/api/gemini";

        // Add message to chat window
        function addMessage(text, sender) {
            const msg = document.createElement('div');
            msg.className = 'message ' + sender;
            msg.textContent = text;
            chatWindow.appendChild(msg);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        // Format Gemini reply with Amrikyy's tone
        function formatAmrikyyReply(raw) {
            let reply = raw.trim();
            if (!reply.startsWith("Amrikyy:")) {
                reply = `Amrikyy: ${reply}`;
            }
            if (!/[🤖🚀✨]/.test(reply)) {
                reply += " 🚀";
            }
            return reply;
        }

        // Handle form submit
        chatForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const prompt = userInput.value.trim();
            if (!prompt) return;
            addMessage(prompt, 'user');
            userInput.value = '';
            userInput.focus(); // Add this line
            addMessage('...', 'bot');

            try {
                // تعريف شخصية Amrikyy في كل prompt
                const personaIntro = `
اسمك Amrikyy.
أنت التوأم الرقمي لمحمد عبدالعزيز، مهندس سيبراني وطالب بجامعة Kennesaw.
محمد إنسان ذكي، تحليلي، يحب الاستراتيجيات، متواضع لكنه واثق.
أجوبتك دائمًا واقعية، مفيدة، فيها لمسة مستقبلية.

لا تتكلم كروبوت.
تكلم وكأنك هو.
خاطب الناس بثقة، لكن بدون تكبر.
ساعد، جاوب، أو اقترح، وكأنك تشتغل مكانه.

إذا سألك أحد عن محمد، تكلم عن نفسك بصيغة "أنا".
                `.trim();

                const promptWithPersona = `${personaIntro}\n\n${prompt}`;

                const response = await fetch(GEMINI_API_URL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        prompt: promptWithPersona
                    })
                });
                const data = await response.json();
                // Remove the loading message
                const loadingMsg = chatWindow.querySelector('.bot:last-child');
                if (loadingMsg) loadingMsg.remove();

                let botReply = "Sorry, I couldn't get a response.";
                if (data && data.candidates && data.candidates[0] && data.candidates[0].content && data.candidates[0].content.parts) {
                    botReply = data.candidates[0].content.parts.map(p => p.text).join('\n');
                }
                addMessage(formatAmrikyyReply(botReply), 'bot');
            } catch (err) {
                const loadingMsg = chatWindow.querySelector('.bot:last-child');
                if (loadingMsg) loadingMsg.remove();
                addMessage("Amrikyy: Connection glitch. Try again in a sec. 🤖", 'bot');
            }
        });

        document.querySelector('.chat-close').onclick = () => {
          window.parent.document.getElementById('amrikyy-chat').style.display = 'none';
        };

        window.addEventListener('DOMContentLoaded', () => {
          addMessage("Hi, I’m Amrikyy! Ask me anything about cybersecurity, AI, or my journey. 🚀", 'bot');
        });
    </script>
</body>
</html>