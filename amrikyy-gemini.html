<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Amrikyy Gemini Chatbot</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            background: #0D0D0D;
            color: #e0e0e0;
            font-family: 'Roboto', Arial, sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        /* Chatbot Styles Fix */
        .chat-container {
          max-width: 420px;
          margin: 0 auto;
          background: #111;
          border: 2px solid #39FF14;
          border-radius: 16px;
          padding: 16px;
          box-shadow: 0 0 15px rgba(57, 255, 20, 0.3);
          position: fixed;
          right: 20px;
          bottom: 20px;
          z-index: 999;
        }

        .chat-title {
          text-align: center;
          font-size: 1.2rem;
          color: #39FF14;
          font-weight: bold;
          margin-bottom: 10px;
        }

        .chat-window {
          height: 300px;
          overflow-y: auto;
          padding: 8px;
          background: #0d0d0d;
          border-radius: 8px;
          margin-bottom: 10px;
        }
        .input-row {
            display: flex;
            gap: 8px;
        }
        .input-row input[type="text"] {
          flex: 1;
          padding: 10px;
          background: #181818;
          color: #fff;
          border: 1px solid #39FF14;
          border-radius: 6px;
          font-size: 1rem;
        }

        .input-row button {
          background: #39FF14;
          color: #000;
          border: none;
          padding: 10px 16px;
          font-weight: bold;
          border-radius: 6px;
          cursor: pointer;
        }

        /* Chat message bubbles */
        .message {
          display: inline-block;
          max-width: 90vw; /* Was 80%, now 90vw for mobile */
          padding: 10px 16px;
          margin: 8px 0;
          border-radius: 18px;
          font-size: 1em;
          line-height: 1.5;
          word-break: break-word;
          box-shadow: 0 2px 8px rgba(57,255,20,0.07);
          position: relative;
          clear: both;
        }
        .message.user {
          background: #e0e0e0;
          color: #222;
          align-self: flex-end;
          margin-left: 20%;
          border-bottom-right-radius: 4px;
          border-top-right-radius: 18px;
          border-top-left-radius: 18px;
          border-bottom-left-radius: 18px;
        }
        .message.bot {
          background: #181f1b;
          color: #39FF14;
          border: 1.5px solid #39FF14;
          align-self: flex-start;
          margin-right: 20%;
          border-bottom-left-radius: 4px;
          border-top-right-radius: 18px;
          border-top-left-radius: 18px;
          border-bottom-right-radius: 18px;
          box-shadow: 0 0 8px #39FF1444;
        }
        button {
            background: #39FF14;
            color: #0D0D0D;
            border: none;
            border-radius: 6px;
            padding: 14px 22px; /* Larger padding */
            font-weight: bold;
            font-size: 1.15em;  /* Larger font */
            min-width: 48px;    /* Minimum touch target */
            min-height: 48px;
            cursor: pointer;
            transition: background 0.2s;
        }
        button:hover {
            background: #2ecc10;
        }
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-thumb {
            background: #222;
            border-radius: 4px;
        }
        /* تحسين تجربة Amrikyy على الجوال */
        @media (max-width: 600px) {
            .chat-container {
                width: 100%;
                max-width: 100%;
                right: 0;
                left: 0;
                bottom: 0;
                border-radius: 0;
                padding: 12px;
            }
            .chat-window {
                height: 50vh;
            }
            .input-row input[type="text"],
            .input-row button {
                font-size: 0.95rem;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <span class="chat-title">Amrikyy</span>
            <button class="chat-close" title="Close">&times;</button>
        </div>
        <div class="chat-window" id="chat-window"></div>
        <form class="input-row" id="chat-form" autocomplete="off">
            <input type="text" id="user-input" placeholder="Type your message..." required autofocus />
            <button type="submit">Send</button>
        </form>
    </div>
    <script>
        const chatWindow = document.getElementById('chat-window');
        const chatForm = document.getElementById('chat-form');
        const userInput = document.getElementById('user-input');

        // Gemini Pro API endpoint (your backend proxy)
        const GEMINI_API_URL = "https://0e45fe78-86ad-4c8f-b665-f561edd3e592-00-ezbtmwl50c4e.riker.replit.dev:5000/api/gemini";

        // Add message to chat window
        function addMessage(text, sender) {
            const msg = document.createElement('div');
            msg.className = 'message ' + sender;
            msg.textContent = text;
            chatWindow.appendChild(msg);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        // Format Gemini reply with Amrikyy's tone
        function formatAmrikyyReply(raw) {
            let reply = raw.trim();
            if (!reply.startsWith("Amrikyy:")) {
                reply = `Amrikyy: ${reply}`;
            }
            if (!/[🤖🚀✨]/.test(reply)) {
                reply += " 🚀";
            }
            return reply;
        }

        // Handle form submit
        chatForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const prompt = userInput.value.trim();
            if (!prompt) return;
            addMessage(prompt, 'user');
            userInput.value = '';
            userInput.focus(); // Add this line
            addMessage('...', 'bot');

            try {
                // تعريف شخصية Amrikyy في كل prompt
                const personaIntro = `
اسمك Amrikyy.
أنت التوأم الرقمي لمحمد عبدالعزيز، مهندس سيبراني وطالب بجامعة Kennesaw.
محمد إنسان ذكي، تحليلي، يحب الاستراتيجيات، متواضع لكنه واثق.
أجوبتك دائمًا واقعية، مفيدة، فيها لمسة مستقبلية.

لا تتكلم كروبوت.
تكلم وكأنك هو.
خاطب الناس بثقة، لكن بدون تكبر.
ساعد، جاوب، أو اقترح، وكأنك تشتغل مكانه.

إذا سألك أحد عن محمد، تكلم عن نفسك بصيغة "أنا".
                `.trim();

                const promptWithPersona = `${personaIntro}\n\n${prompt}`;

                const response = await fetch(GEMINI_API_URL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        prompt: promptWithPersona
                    })
                });
                const data = await response.json();
                // Remove the loading message
                const loadingMsg = chatWindow.querySelector('.bot:last-child');
                if (loadingMsg) loadingMsg.remove();

                let botReply = "Sorry, I couldn't get a response.";
                if (data && data.candidates && data.candidates[0] && data.candidates[0].content && data.candidates[0].content.parts) {
                    botReply = data.candidates[0].content.parts.map(p => p.text).join('\n');
                }
                addMessage(formatAmrikyyReply(botReply), 'bot');
            } catch (err) {
                const loadingMsg = chatWindow.querySelector('.bot:last-child');
                if (loadingMsg) loadingMsg.remove();
                addMessage("Amrikyy: Connection glitch. Try again in a sec. 🤖", 'bot');
            }
        });

        document.querySelector('.chat-close').onclick = () => {
          window.parent.document.getElementById('amrikyy-chat').style.display = 'none';
        };

        window.addEventListener('DOMContentLoaded', () => {
          addMessage("Hi, I’m Amrikyy! Ask me anything about cybersecurity, AI, or my journey. 🚀", 'bot');
        });
    </script>
</body>
</html>